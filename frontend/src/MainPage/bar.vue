
<template>
<div style="margin:auto;height: auto;text-align:center; background-image: url(http://pic1.win4000.com/wallpaper/2017-10-12/59df06d7c561f.jpg); background-repeat:repeat;">
    <div class="hidScroller">


  <el-container >
           <el-aside width="200px" style="padding:20px;" >
          <el-container class="asid-rank" style="background-color:white">
            <el-main>

              <p><b>贴吧简介</b></p>
        
            </el-main>
            </el-container>

      </el-aside>

      <el-main  style="border-radius:25px;">
        <div style="padding:20px;border-radius:25px;background-color:white"  class="back"  >
        <div>
            <el-table
            @row-click="gotoPost"
              :data="barData.slice((currentPage-1)*pagesize,currentPage*pagesize)" 
              v-loading="loading">
              
              <el-table-column
                prop="POSTTIME"
                label="发帖时间">
              </el-table-column>
              <el-table-column
                prop="POSTTITLE"
                label="帖子标题">
              </el-table-column>
              <el-table-column
                prop="USERID"
                label="发贴用户">
              </el-table-column>
            </el-table>

           
        </div>
        </div>
        <div>
        <br>
        <el-divider></el-divider>
        </div>
         <el-container  class="back" style="padding:20px;border-radius:25px;" >
           <el-main>
            <b style="float:left">发帖</b>
            <div>
            <el-row>
                <el-input placeholder="请填写标题" v-model="postTitle" size="media" clearable> </el-input>
            </el-row>
            <br>
            </div>
            <div>
            <el-row>
                <el-input type="textarea" :rows="2" placeholder="请输入内容" v-model="postContent">  </el-input>
            </el-row>
            <el-row>
              <br>
                <el-button type="primary" style="float:left" @click="onSubmit()">发表</el-button>
            </el-row>
            </div>
           </el-main>
          </el-container>
      </el-main>
                <el-aside width="200px" style="padding:20px;" >
          <el-container class="asid-rank" style="background-color:white;height:500px">
            <el-main style="height:500px">

              <p><b>贴吧排行</b></p>

            
                <el-row v-for="(barItem,index) in AdRankList" :key="index" :gutter="2">
                  <span>
                    <el-col :span="4">
                      <el-button type="text" @click="toBar(barItem.router)">{{index+1}}</el-button>
                      </el-col>
                    <el-col :span="4">
                    <el-button type="text" @click="toBar(barItem.router)">{{barItem.TIEBAID}}</el-button>
                    </el-col>
                  </span>
                </el-row>
       
            </el-main>
            </el-container>

      </el-aside>
  </el-container>



    </div>
</div>

</template>

<script>
  export default {
    data() {
     
      return {
        barData:[],
        barTitle:"1",
        barIntro:"",
        barImgUrl:require('../assets/1.jpg'),
        currentPage:1,
        pagesize:5,
        loading:true,
        postTitle:"",
        postContent:"",
        AdRankList:[],
        url:'/postid='
      }
    },
    mounted()
    {
      //sthis.getParams();
      this.getPost();
      this.getAdRank('http://139.196.167.75:5000/api/Ranking');
    },
    methods:{
      gotoPost(row){
        console.log("1:" + row);
        this.url = this.url + row.POSTID;
        localStorage.setItem('postID',row.POSTID);
        this.$router.push({path:this.url});
        location.reload();
      },
       rankStore(item)
    {
      this.AdRankList=JSON.parse(item);
      console.log(this.AdRankList);
    },
    async onSubmit()
    {
      const Data=
      {
        posttitle : this.postTitle,
        content : this.postContent,
        userid : localStorage.getItem("userID"),
        tiebaid : this.barTitle

      }
      console.log(Data)
      var url='http://139.196.167.75:5000/api/Post/SendPost'
      await fetch(url, {
        method: 'POST',
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(Data)
      })
        .catch(error => {console.log(error)})
      location.reload();   
    },
      postStore(data)
      {
        this.barData=JSON.parse(data);
        console.log(this.barData);
      },
      
      async getPost()
      {
        var url='http://139.196.167.75:5000/api/TieBaA/' + this.barTitle;
        console.log(url);
        await fetch(url, {
            method: 'GET',
            headers: {
              'Accept': 'application/json',
              'Content-Type': 'application/json',
              
            },
          })
          .then(response => response.json())
          .then(data => this.postStore(data));
          this.loading=false;
          console.log("Geted");

      },
      async getAdRank(url)
    {
      await fetch(url, {
            method: 'GET',
            headers: {
              'Accept': 'application/json',
              'Content-Type': 'application/json'
            },
          })
          .then(response => response.json())
          .then(data => this.rankStore(data));
          console.log("Geted");

        }
    }
  };
</script>

<style>
.el-header {
    background-color: #B3C0D1;
    color: #333;
    line-height: 60px;
      border-radius: 20px;

    
  }

  .el-aside {
    color: #333;
  }
/*最外层透明*/
.el-table, .el-table__expanded-cell{
  background:  #ffffff;

}
/* 表格内背景颜色 */
.el-table th,
.el-table tr,
.el-table td {
      background: hsl(0, 0%, 100%);
}
.mainback{
     background: #40a0ff7c;
        border-color: #40a0ff7c; 
        border-style: solid;  
        border-width: 2px;  
}
.postTitle
{
    font-size:20px;
    cursor:pointer;
    font-weight:bold;
}
.postUser
{
    font-size:5px;
    cursor:pointer;
    font-weight:bold;
}
.bar-header{
   border-color: rgba(255, 255, 255, 0.829);
  background-color: rgba(255, 255, 255, 0.925);
  border-radius: 20px;
    border-style: solid;  
    border-width: 2px;  
  height: 280px;
}
</style>
